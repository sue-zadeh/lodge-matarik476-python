{% extends 'base.html' %}

{% block title %}Your Profile – Lodge Matariki 476{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
  <div class="col-md-8 col-lg-6">
    <div class="card bg-dark text-light border-0 shadow-lg">
      <div class="card-body text-center">

        {# Profile image #}
        <div class="text-center mb-4">
<div class="position-relative d-inline-block">
  <img
    src="{% if user.profile_image %}
            {{ url_for('static', filename='uploads/' ~ user.profile_image) }}
         {% else %}
            {{ url_for('static', filename='img/logo1.jpg') }}
         {% endif %}"
    alt="Profile picture"
    class="rounded-circle border border-warning shadow"
    style="width: 150px; height: 150px; object-fit: cover;"
  >

  {# Pen button – opens file chooser, does NOT go to edit_profile #}
  <button type="button"
          class="position-absolute bg-warning rounded-circle p-2 shadow hover-lift border-0"
          style="bottom: 5px; right: 5px;"
          onclick="document.getElementById('profileImageInput').click();">
    <i class="fas fa-pen text-dark"></i>
  </button>
</div>

{# Hidden form that actually uploads the new picture #}
<form id="profileImageForm"
      action="{{ url_for('update_profile_image') }}"
      method="POST"
      enctype="multipart/form-data"
      class="d-none">
  <input type="file"
         name="profile_image"
         id="profileImageInput"
         accept="image/*"
         onchange="document.getElementById('profileImageForm').submit();">
</form>


    <!-- <a href="{{ url_for('edit_profile') }}"
       class="position-absolute bg-warning rounded-circle p-2 shadow"
       style="right: -4px; bottom: -4px;">
      <i class="fas fa-pen text-dark"></i>
    </a>
  </div> -->
</div>

        <h2 class="mb-0">
          {{ user.first_name }} {{ user.last_name }}
        </h2>
        <p class="text-warning mb-3">
          {{ user.role|capitalize }}
        </p>

        <hr class="border-secondary">

        <div class="text-start">
          <p class="mb-2">
            <i class="fas fa-user me-2 text-warning"></i>
            <strong>Username:</strong> {{ user.username }}
          </p>
          
          <p class="mb-2">
            <i class="fas fa-envelope me-2 text-warning"></i>
            <strong>Email:</strong> {{ user.email }}
          </p>
          {% if user.phone %}
          <p class="mb-2">
            <i class="fas fa-phone me-2 text-warning"></i>
            <strong>Phone:</strong> {{ user.phone }}
          </p>
          {% endif %}
          {% if user.birth_date %}
          <p class="mb-2">
            <i class="fas fa-birthday-cake me-2 text-warning"></i>
            <strong>Date of birth:</strong> {{ user.birth_date }}
          </p>
          {% endif %}
          <p class="mb-0">
            <i class="fas fa-check-circle me-2 text-warning"></i>
            <strong>Status:</strong>
            {% if user.is_active %}Active member{% else %}Inactive{% endif %}
          </p>
        </div>

        <div class="mt-4 d-flex justify-content-center gap-3">
    <a href="{{ url_for('edit_profile') }}" class="btn btn-outline-warning">
        <i class="fas fa-user-edit"></i> Edit Profile
    </a>
    <a href="{{ url_for('change_password') }}" class="btn btn-outline-warning">
        <i class="fas fa-key"></i> Change Password
    </a>
    <form action="{{ url_for('delete_profile') }}" method="POST" onsubmit="return confirm('Are you sure?');">
    <button class="btn btn-outline-danger">Delete Profile</button>
</form>

    <a href="{{ url_for('home') }}" class="btn btn-outline-secondary">
        <i class="fas fa-home"></i> Back to Home
    </a>
</div>

      </div>
    </div>

    {# If later you add messages/announcements per user, they can appear here #}
    {% if messages %}
      <div class="card bg-dark text-light border-0 shadow mt-4">
        <div class="card-body">
          <h4 class="mb-3">Your lodge messages</h4>
          <ul class="list-group list-group-flush">
            {% for msg in messages %}
              <li class="list-group-item bg-dark text-light border-secondary">
                {{ msg.content }}
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
